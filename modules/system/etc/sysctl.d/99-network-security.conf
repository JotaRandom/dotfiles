# Configuración de seguridad de red
# Protecciones genéricas contra ataques comunes, manteniendo usabilidad en laptops

## Defensa contra ataques de red

# Protección contra SYN flood (ataque clásico de denegación de servicio)
net.ipv4.tcp_syncookies = 1

# Deshabilitar reenvío de paquetes (esta máquina no es un router)
net.ipv4.ip_forward = 0
net.ipv6.conf.all.forwarding = 0

# No aceptar redirecciones ICMP (pueden usarse en ataques de redireccionamiento)
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# No aceptar rutas de origen (source routes) — pueden usarse en ataques de ruta
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0

# Registrar paquetes anómalos/maliciosos para auditoría
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# Rechazar redirects ICMP también cuando el kernel usa routing
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0

## TCP hardening

# Protección contra TIME-WAIT assassination attacks
net.ipv4.tcp_rfc1337 = 1

# Disminuir TIME-WAIT para permitir reusó de conexiones más rápidamente
# (útil para laptops con muchas conexiones cortas, ej. navegación web)
net.ipv4.tcp_fin_timeout = 20

# Keepalive: detectar conexiones muertas; laptop-friendly (10 minutos)
net.ipv4.tcp_keepalive_time = 600
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_intvl = 30

# Aumentar backlog de conexiones en escucha (mejor para servidores, no afecta laptop)
net.ipv4.tcp_max_syn_backlog = 4096

## IPv6 (mantener funcionalidad, pero securizado)

# Aceptar router advertisements (necesario para autoconfiguracion IPv6)
# pero solo en interfaces de confianza
net.ipv6.conf.all.accept_ra = 0
net.ipv6.conf.default.accept_ra = 1

# No aceptar redirects IPv6
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# No actuar como router IPv6
net.ipv6.conf.all.forwarding = 0

## ICMP (ping)

# Permitir ICMP echo (ping) — útil para diagnósticos de red en laptop
# Si quieres bloquearlo completamente, descomenta:
# net.ipv4.icmp_echo_ignore_all = 1
# net.ipv6.conf.all.disable_ipv6 = 0 (mantener IPv6)

# Pero limitar respuestas ICMP para evitar amplification attacks
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1

## Conexiones de red

# Limitar número de sockets en TIME_WAIT (evitar exhaustión)
net.ipv4.tcp_max_tw_buckets = 2000000

# Enable bad error message protection
net.ipv4.tcp_invalid_ratelimit = 500
