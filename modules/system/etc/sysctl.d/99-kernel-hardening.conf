# Endurecimiento de kernel — mejora de seguridad sin romper funcionalidad
# Configuración moderna de Linux para laptop/escritorio

## Protección de memoria

# ASLR (Address Space Layout Randomization) — dificulta exploits
kernel.randomize_va_space = 2

# Protección contra ataques de corrupción de memoria
# mmap_min_addr: mínima dirección permitida para mapeos; previene null pointer dereferences
vm.mmap_min_addr = 65536

# Magic SysRq — controlado por sysctl (ver 99-reisub.conf)
# kernel.sysrq = 1

## Core dumps

# Deshabilitar core dumps (contienen información sensible) 
# pero permitir si es necesario para debugging
# kernel.core_uses_pid = 1
fs.suid_dumpable = 0

## Kernel panic y reboot

# No reiniciar automáticamente si el kernel entra en panic
# (descomenta si quieres reinicio automático para servidores)
# kernel.panic = 10
# kernel.panic_on_oops = 1

# Pero sí aumentar la información de debugging
kernel.printk = 3 3 3 3

## Permisos y módulos

# Restringir carga de módulos del kernel (requiere privilegios explícitos)
# Nota: esto puede afectar instalación de drivers (nvidia, virtualbox, etc.)
# kernel.modules_disabled = 0

# Restringir acceso a kexec (kexec = cargar nuevo kernel sin reboot)
# kernel.kexec_load_disabled = 1

## Protección de archivos

# Aumentar protección contra race conditions en filesystem
fs.protected_symlinks = 1
fs.protected_hardlinks = 1

# Deshabilitar acceso a /proc/kcore (información sensible del kernel)
fs.protected_regular = 2

## Restricciones de ptrace

# Restringir ptrace() a procesos del mismo usuario
# (requiere CAP_SYS_PTRACE, afecta debuggers como gdb)
# kernel.yama.ptrace_scope = 2

# Si necesitas usar gdb sin sudo, descomenta esto:
# kernel.yama.ptrace_scope = 1

## Restricción de dmesg

# Solo root puede acceder a dmesg (evita información de kernel a usuarios)
kernel.dmesg_restrict = 1

## Memory accounting

# Detectar intentos de acceso a memoria no asignada
# (puede ser útil para encontrar bugs, pero impacta rendimiento)
# vm.overcommit_memory = 1

## Restricción de namespaces

# Solo root puede usar user namespaces (afecta containers/sandboxing)
# Nota: descomenta solo si no usas Docker/Podman como usuario normal
# kernel.unprivileged_userns_clone = 0

## Restricción de BPF

# Solo root puede usar eBPF (herramienta de debugging poderosa pero de riesgo)
# Nota: algunas aplicaciones modernas pueden requerirlo
# kernel.unprivileged_bpf_disabled = 1
